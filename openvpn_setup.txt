Ubuntu based linux
-----------------

1. Initial Steps:
------------------

a. provision a ec2 instance in private subnet (without assigning a public ip)
b. security rule should have below inbound rules:
Port range      protocol      source
22              SSH            0.0.0.0/0
1194            UDP            0.0.0.0/0
3. Allocate an elastic ip and associate it with this vm.



2. Key pem to ppk or vice-versa
-------------------------------

a. key created has 2 formats either ppk or pem.
b. putty supports .ppk format whereas openssh support .pem format.
c. Depending on the format, it might need to be converted to the other format using puttygen command.
d. change the permission of the file to 600 (rw-------)
e. run below puttygen command:
$puttygen <keyname>.ppk -O private-openssh -o <keyname>.pem
OR
$puttygen <keyname>.pem -O private-openssh -o <keyname>.ppk



3. Connect to VM
------------------

a. ssh -i <keyname> ubuntu@<VM public ip>
b. once connected run
$sudo apt update
c. check the status of openvpn
$apt policy ovenvpn

output of the above command:

#####
openvpn:
  Installed: (none)
  Candidate: 2.5.9-0ubuntu0.22.04.2
  Version table:
     2.5.9-0ubuntu0.22.04.2 500
        500 http://ap-south-1.ec2.archive.ubuntu.com/ubuntu jammy-updates/main amd64 Packages
     2.5.5-1ubuntu3 500
        500 http://ap-south-1.ec2.archive.ubuntu.com/ubuntu jammy/main amd64 Packages
######
default vpn repository contains openvpn 2.5.9 which may not be the latest one; so check its latest available version in:
https://github.com/OpenVPN/openvpn/tags



4. Installing the openvpn
-----------------------

a. since next few commands need to be run as sudo, so switch to sudo user
$sudo su -

b. Now lets add a GPG key that is used to verify the integrity of the downloaded package
$wget -O - https://swupdate.openvpn.net/repos/repo-public.gpg|apt-key add -

c. then add openvpn ubuntu repository; it is best practice to create a separate list
$echo "deb http://build.openvpn.net/debian/openvpn/stable focal main" > /etc/apt/sources.list.d/openvpn-aptrepo.list

d. Now perform apt update to check what is available now.
$apt update

e. then exit from root user

f. now check again the available version of openvpn
$apt policy openvpn

g. Now install the latest availble version; optionally specify the version with = sign
$sudo apt install openvpn=2.6.9-focal0

#####
this command may throw this error:
The following packages have unmet dependencies:
 openvpn : Depends: libssl1.1 (>= 1.1.1) but it is not installable
E: Unable to correct problems, you have held broken packages.
#####

to resolve this issue run below command: (Ubuntu 22.04 has upgraded libssl to 3 and does not propose libssl1.1)
$echo "deb http://security.ubuntu.com/ubuntu focal-security main" | sudo tee /etc/apt/sources.list.d/focal-security.list
$Sudo apt-get update
$sudo apt-get install libssl1.1

Then rerun the command "sudo apt install openvpn=2.6.9-focal0"
Once installed, delete the focal-security list file just created: 
$sudo rm /etc/apt/sources.list.d/focal-security.list


5. Managing public Key
-----------------------
Some kind of tool is required to manage the public Key Infrastructure (PKI). It is very common to use easy-rsa with openvpn; since it is a tool built by openVPN community.
However we can use the  CFSSL, openssl or any other option to maintain certificates. lets try with easy-rsa option.

    5.1 easy-rsa
    -------------
    a. $apt policy easy-rsa
    b. check the latest available version from https://github.com/OpenVPN/easy-rsa
    c. lets just download the tarball and place it
    $wget https://github.com/OpenVPN/easy-rsa/releases/download/v3.1.7/EasyRSA-3.1.7.tgz
    $tar -zxf EasyRSA-3.1.7.tgz
    clean up the .tgz file.
    d. Move the EasyRSA under openvpn
    $mv EasyRSA-3.1.7/ /etc/openvpn/easy-rsa


















